{% extends "../base.html" %}
{% load static %}
{% block title %}新增博客分类{% endblock %}

{% block link %}

    <!-- Bootstrap Core Css -->
    <link href="{% static 'plugins/bootstrap/css/bootstrap.css' %}" rel="stylesheet">

    <!-- Waves Effect Css -->
    <link href="{% static 'plugins/node-waves/waves.css' %}" rel="stylesheet" />

    <!-- Animation Css -->
    <link href="{% static 'plugins/animate-css/animate.css' %}" rel="stylesheet" />

    <!-- Custom Css -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">

    <!-- AdminBSB Themes. You can choose a theme from css/themes instead of get all themes -->
    <link href="{% static 'css/themes/all-themes.css' %}" rel="stylesheet" />
    <!-- Colorpicker Css -->
    <link href="{% static 'plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.css' %}" rel="stylesheet" />

    <!-- Dropzone Css -->
    <link href="{% static 'plugins/dropzone/dropzone.css' %}" rel="stylesheet">

    <!-- Multi Select Css -->
    <link href="{% static 'plugins/multi-select/css/multi-select.css' %}" rel="stylesheet">

    <!-- Bootstrap Spinner Css -->
    <link href="{% static 'plugins/jquery-spinner/css/bootstrap-spinner.css' %}" rel="stylesheet">

    <!-- Bootstrap Tagsinput Css -->
    <link href="{% static 'plugins/bootstrap-tagsinput/bootstrap-tagsinput.css' %}" rel="stylesheet">

    <!-- Bootstrap Select Css -->
    <link href="{% static 'plugins/bootstrap-select/css/bootstrap-select.css' %}" rel="stylesheet" />

    <!-- noUISlider Css -->
    <link href="{% static 'plugins/nouislider/nouislider.min.css' %}" rel="stylesheet" />
{% endblock %}



<!--主体填充-->
{% block main_body %}

   <div class="container-fluid">
       <!--面包屑-->
      <ol class="breadcrumb breadcrumb-bg-orange">
				<li><a href="{% url 'index:index_show' %}">首页</a></li>
				<li class="active">新增博客分类</li>
      </ol>

      <!-- 文章基础信息编辑 -->
      <div class="row clearfix">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <div class="card">
                  <div class="body">

                      <!--tips -->
                      <div class="header">

                          <h2>
                              <strong>博客分类信息</strong>
                              <small>请在下方填写博客分类信息</small>
                          </h2>
                      </div>

                      <br>

                      <form id="mainFrom" action="" method="post">
                      {% csrf_token %}

                      <!-- 博客名称 -->

                      <div class="row clearfix">
                          <div class="col-md-6">
                              <div class="input-group">
                                  <span class="input-group-addon">
                                      <i class="material-icons">trending_up</i>
                                  </span>
                                  <div class="col-md-8">
                                      <div class="form-line">
                                      <input type="text"  class="form-control date" placeholder="博客分类名称" name="blogcatetitle" value="{{ current_category.name }}">
                                     </div>
                                  </div>
                                  <div class="col-md-4">
                                      <span id="links_name"></span>
                                  </div>

                              </div>
                          </div>
                      </div>
                    <!-- 博客分类路由 -->
                      <div class="row clearfix">
                          <div class="col-md-6">
                              <div class="input-group">
                                  <span class="input-group-addon">
                                      <i class="material-icons">trending_up</i>
                                  </span>
                                  <div class="col-md-8">
                                    <div class="form-line">
                                      <input type="text"  class="form-control date" placeholder="博客分类路由" name="path" value="{{ current_category.path }}">
                                    </div>
                                  </div>
                                    <div class="col-md-4">
                                        <span id="links_path"></span>
                                    </div>
                              </div>
                          </div>
                      </div>



                      <div class="row clearfix">
                          <div class="col-md-3">
                            <p>
                              <b>权重值（值越大，排名靠前）</b>
                            </p>
                              <div class="input-group spinner" data-trigger="spinner">
                                  <div class="form-line">
                                      <input type="text" class="form-control text-center" name="orderpoint" value="{{ current_category.list_order | default:0 }}" data-rule="listorder">
                                  </div>
                                  <span class="input-group-addon">
                                      <a href="javascript:;" class="spin-up" data-spin="up"><i class="glyphicon glyphicon-chevron-up"></i></a>
                                      <a href="javascript:;" class="spin-down" data-spin="down"><i class="glyphicon glyphicon-chevron-down"></i></a>
                                  </span>
                              </div>
                          </div>
                      </div>



                      <div class="row clearfix">
                          <div class="col-md-12">
                              <a  type="button" id="submin_btn" class="btn bg-red waves-effect col-md-2">提交</a>
                          </div>
                      </div>

                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>
{% endblock %}

{% block endlinks %}
    <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>

    <!-- Bootstrap Core Js -->
    <script src="{% static 'plugins/bootstrap/js/bootstrap.js' %}"></script>

    <!-- Select Plugin Js -->
    <script src="{% static 'plugins/bootstrap-select/js/bootstrap-select.js' %}"></script>

    <!-- Slimscroll Plugin Js -->
    <script src="{% static 'plugins/jquery-slimscroll/jquery.slimscroll.js' %}"></script>

    <!-- Bootstrap Colorpicker Js -->
    <script src="{% static 'plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js' %}"></script>

    <!-- Dropzone Plugin Js -->
    <script src="{% static 'plugins/dropzone/dropzone.js' %}"></script>

    <!-- Input Mask Plugin Js -->
    <script src="{% static 'plugins/jquery-inputmask/jquery.inputmask.bundle.js' %}"></script>

    <!-- Multi Select Plugin Js -->
    <script src="{% static 'plugins/multi-select/js/jquery.multi-select.js' %}"></script>

    <!-- Jquery Spinner Plugin Js -->
    <script src="{% static 'plugins/jquery-spinner/js/jquery.spinner.js' %}"></script>

    <!-- Waves Effect Plugin Js -->
    <script src="{% static 'plugins/node-waves/waves.js' %}"></script>

    <!-- Ckeditor -->
    <script src="{% static 'plugins/ckeditor/ckeditor.js' %}"></script>

    <!-- Bootstrap Tags Input Plugin Js -->
    <script src="{% static 'plugins/bootstrap-tagsinput/bootstrap-tagsinput.js' %}"></script>

    <!-- noUISlider Plugin Js -->

    <!-- TinyMCE -->
    <script src="{% static 'plugins/tinymce/tinymce.js' %}"></script>

    <!-- Custom Js -->
    <script src="{% static 'js/admin.js' %}"></script>

    <!-- Demo Js -->
    <script src="{% static 'js/demo.js' %}"></script>

  <script type="text/javascript">{{ jscode|default:"" |safe }}</script>

	<script>
	    $('.with-gap').click(function(){
	        if($('input[name="ctype"]').prop("checked"))
	        {
	            $('#showselect').hide();

	        }
	        else
	        {
	            $('#showselect').show();
	        }
	    });
	</script>

    <script>
    var linkspath = false;
    var linksname = false;
    //验证name
    $('[name=blogcatetitle]').click(function () {
        $('#links_name').css('color','#777777');
        $('#links_name').html('<i class="material-icons" style="font-size: 15px">add_alert</i>&nbsp;&nbsp;&nbsp;请输入博客分类名称');
    });
    $('[name=blogcatetitle]').keyup(function () {
        if(check($(this).val())){
             $.ajax({
                async: true,
                type:'get',
                url:"{% url 'blogcate:checkblogcatename' %}",
                dataType:'json',
                data:{'blogname':$(this).val()},
                success:function (data) {
                    if(data.msg==1){
                        $('#links_name').css('color','#777777');
                        $('#links_name').html('<i class="material-icons" style="font-size: 15px">done</i>&nbsp;&nbsp;&nbsp;博客分类名称可以使用^ ^');
                        linksname = true
                    }else{
                        $('#links_name').css('color','red');
                        $('#links_name').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;博客分类名称已重复！');
                        linksname = false
                    }
                }
            })
        }else{
            $('#links_name').css('color','red');
            $('#links_name').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;博客分类名称不能包含空格！');
            linksname=false
        }

    });
    //验证链接
    $('[name=path]').click(function () {
        $('#links_path').css('color','#777777');
        $('#links_path').html('<i class="material-icons" style="font-size: 15px">add_alert</i>&nbsp;&nbsp;&nbsp;请输入博客分类路由');
    });

    $('[name=path]').keyup(function () {
        if(check($(this).val())){
            $.ajax({
                async: true,
                type:'get',
                url:"{% url 'blogcate:checkblogcatepath' %}",
                dataType:'json',
                data:{'blogpath':$(this).val()},
                success:function (data) {
                    if(data.msg==1){
                        $('#links_path').css('color','#777777');
                        $('#links_path').html('<i class="material-icons" style="font-size: 15px">done</i>&nbsp;&nbsp;&nbsp;博客分类路由可以使用^ ^');
                        linkspath = true
                    }else{
                        $('#links_path').css('color','red');
                        $('#links_path').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;博客分类路由已重复！');
                        linkspath = false
                    }
                }
            })
        }else{
            $('#links_path').css('color','red');
            $('#links_path').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;博客分类路由不能包含空格！');
            linkspath =false
        }

    });

    function check(obj) {
        if(obj.indexOf(' ') == -1&& obj !=''){
            return true
        }else{
            return false
        }
    }

    $('#submin_btn').click(function () {
        if(linkspath && linksname){
            $('#mainFrom').submit()
        }else{
            if(linksname){
                $('#links_path').css('color','red');
                $('#links_path').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;请输入博客分类路由');
                swal('请输入博客分类路由！','博客分类路由不能为空且不能重复！','error')
            }
            else if(linkspath){
                $('#links_name').css('color','red');
                $('#links_name').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;请输入博客分类名称');
                swal('请输入博客分类名称！','博客分类名称不能为空且不能重复！','error')
            }else{
                $('#links_path').css('color','red');
                $('#links_path').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;请输入博客分类路由');
                $('#links_name').css('color','red');
                $('#links_name').html('<i class="material-icons" style="font-size: 15px">error_outline</i>&nbsp;&nbsp;请输入博客分类名称');
                swal('请输入博客分类名称和博客分类路由！','博客分类名称和博客分类路由不能为空且不能重复！','error')
            }
        }
    })
</script>

{% endblock %}