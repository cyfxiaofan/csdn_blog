{% extends './index.html' %}
{% block up %}
<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="always">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta charset="utf-8">
    <title>3Q-专业IT技术社区-登录</title>
    <script src="../static/js/passport.js" type="text/javascript"></script>
    <link href="../static/css/login.d77cb53619f7d2efa44d6f1fab.css" rel="stylesheet">
    <link  href="../static/layui/css/layui.css"  rel="stylesheet">
    <script src="../static/js/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../static/layui/layui.all.js"></script>
    <link rel="stylesheet" href="../static/css/content_toolbar.css">
</head>

<body>
{% endblock %}

{% block down %}
{% csrf_token %}
<div id="app" class="main-wrap" style="margin-top: 50px">
    <div class="container-main container-pc">
        <div class="main-content">
            <div class="main">
                <div class="main-tu">
                    <!---->
                    <div id="ad-div">
                        <div id="kp_box_286" data-pid="286">
                            <!--<iframe src="https://adaccount.csdn.net/#/preview/1251?m=EpAcDUinLEpHnAicnUmEHJAScvASUStJbSbbttimALSHDmXHctDAvcntEHEtJJtSAnLJQbbStWQvSLfvyQobmJJEiAcLHJSicDLQ&amp;k=" frameborder="0" width="500px" height="500px" scrolling="no"></iframe>-->
                            <img class="" data-src="https://jiamengweb.oss-cn-beijing.aliyuncs.com/3Q.png" src="https://jiamengweb.oss-cn-beijing.aliyuncs.com/3Q.png">
                        </div>
                    </div>
                </div>
                <div class="main-login" style="height: 500px;">
                    <div></div>
                    <div class="main-process-login">
                        <div rol="form" class="form-horizontal form-coustom">
                            <div class="form-group form-control-process">
                                <div class="tab-select col-xs-12 col-sm-12">
                                    <a  id="tabOne" class="tab-one active" style="text-decoration: none;cursor: pointer">账号密码登录</a>
                                    <a  id="tabTwo" class="tab-two" style="text-decoration: none;cursor: pointer">账号注册</a>
                                </div>
                            </div>
                        <!--登陆盒子-->
                        <div class="left_box">
                            <div class="form-group">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <!---->
                                    <input type="text" placeholder="请输入用户ID" id="userid"  name="userid"  class="form-control form-control-icon">
                                    <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                    <div class="control-col-pos control-email">
                                        <ul class="email-list hide"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <input type="password"  placeholder="密码"  id="password" name="'password" class="form-control form-control-icon">
                                    <label for="icon-password" class="icon-coustom-read icon-control">
                                        <svg aria-hidden="true" class="icon">
                                            <use xlink:href="#csdnc-m-passwords-visible"></use>
                                        </svg>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                    <div class="col-xs-6 control-col-pos col-pr-no col-pl-no">
                                    <input type="text" name="imgCode" placeholder="请输入图文验证码" class="form-control form-control-icon" style="width:120px;">
                                    </div>
                                    <div>
                                        <img class="verify_img" src="" alt="验证码" style="float:right;width:110px;height:32px;" >
                                    </div>
                            </div>
                            <!---->
                            <div class="form-group form-group-error">
                                <div id="js_err_dom" class="col-xs-12 col-sm-12 col-pl-no text-error "></div>
                            </div>
                            <div class="form-group form-group-link">
                                <div class="col-xs-12 col-sm-12 col-pr-no col-pl-no">
                                    <a  id="forgetpwd" class="text-link" style="cursor: pointer">忘记密码</a>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-submit col-xs-12 col-sm-12 col-pr-no col-pl-no">
                                    <button  class="btn layui-btn-warm sub">登录</button>
                                </div>
                            </div>
                        </div>
                        <!--登陆盒子end-->

                        <!--注册盒子-->
                        <div class="right_box" style="display: none">
                            <div class="form-group">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <!---->
                                    <input type="text" placeholder="手机号" id="phone"  name="phone"  class="form-control form-control-icon">
                                    <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                    <div class="control-col-pos control-email">
                                        <ul class="email-list hide"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <input type="password"  placeholder="密码"  id="pwd" name="'pwd" class="form-control form-control-icon">
                                    <label for="icon-password" class="icon-coustom-read icon-control">
                                        <svg aria-hidden="true" class="icon">
                                            <use xlink:href="#csdnc-m-passwords-visible"></use>
                                        </svg>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                    <div class="col-xs-6 control-col-pos col-pr-no col-pl-no">
                                    <input type="text" name="imgCode" placeholder="请输入图文验证码" class="form-control form-control-icon" style="width:120px;">
                                    </div>
                                    <div>
                                        <img class="verify_img" src="" alt="验证码" style="float:right;width:110px;height:32px;" >
                                    </div>

                            </div>
                            <div class="form-group">
                                <div class=" col-xs-12 col-sm-12 col-pr-no col-pl-no">
                                    <button  class="btn layui-btn-xs layui-btn-warm get_yzm"  style="width: 100%">获取验证码</button>
                                </div>
                            </div>



                             <div class="form-group">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <!---->
                                    <input type="text" placeholder="验证码" id="yzm"  name="yzm"  class="form-control form-control-icon">
                                    <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                    <div class="control-col-pos control-email">
                                        <ul class="email-list hide"></ul>
                                    </div>
                                </div>
                            </div>
                            <!---->
                            <div class="form-group form-group-error">
                                <div id="js_err_doms" class="col-xs-12 col-sm-12 col-pl-no text-error "></div>
                            </div>


                            <div class="form-group">
                                <div class="form-submit col-xs-12 col-sm-12 col-pr-no col-pl-no">
                                    <button  class="btn layui-btn-warm register">立即注册</button>
                                </div>
                            </div>
                            <!---->

                        </div >
                        <!--注册盒子end-->

                        <!--注册成功盒子-->
                        <div class="new_box" style="display: none">
                            <center>
                                <span class="register_success"></span>
                                <div style="height: 40px">

                                </div>
                                <a id="now_login" style="text-decoration: none;cursor: pointer">立即登陆</a>
                            </center>
                            <script>
                                $('#now_login').click(function () {
                                    layer.msg('您好 , 欢迎来到3Q···');
                                       setTimeout(function () {
                                        location.href='/'
                                         },1000);
                                })
                            </script>
                        </div>
                        <!--注册成功盒子end-->

                        <!--忘记密码盒子-->
                        <div class="forgetpwd_bok" style="display: none">
                            <div class="forgetpwd_step1">
                                <div class="form-group">
                                    <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                        <!---->
                                        <input type="text" placeholder="请输入忘记密码的用户ID" id="fuserid"  name="fuserid"  class="form-control form-control-icon">
                                        <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                        <div class="control-col-pos control-email">
                                            <ul class="email-list hide"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="forgetpwd_step2" style="display: none">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no" style="font-size: 13px;">
                                    <span>短信验证码已发送到您的手机 :</span>
                                    <span class="phonenumber">15517112680</span>
                                </div>
                                <div class="form-group">
                                    <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                        <!---->
                                        <input type="text" placeholder="请输入收到的短信验证码" id="fphonecode"  name="fphonecode"  class="form-control form-control-icon">
                                        <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                        <div class="control-col-pos control-email">
                                            <ul class="email-list hide"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="forgetpwd_step3" style="display: none">
                                <div class="form-group">
                                    <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                        <!---->
                                        <input type="password" placeholder="请输入新密码" id="fpwd"  name="fpwd"  class="form-control form-control-icon">
                                        <label for="icon-close" class="icon-remove  icon-control js_icon hide">×</label>
                                        <div class="control-col-pos control-email">
                                            <ul class="email-list hide"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>




                            <div class="forgetpwd_step4" style="display: none">
                                <div class="col-xs-12 col-sm-12 control-col-pos col-pr-no col-pl-no">
                                    <img src="https://jiamengweb.oss-cn-beijing.aliyuncs.com/right.png" alt="" style="width: 100%;height: 100%i">
                                    <center>
                                    <span>修改成功</span>
                                    </center>

                                </div>
                            </div>



                            <div class="form-group form-group-error">
                                <div id="js_err_domss" class="col-xs-12 col-sm-12 col-pl-no text-error "></div>
                            </div>

                            <div class="form-group">
                                <div class="form-submit col-xs-12 col-sm-12 col-pr-no col-pl-no">
                                    <button  class="btn layui-btn-warm tonext" name="one" >下一步</button>
                                </div>
                            </div>

                        </div>

                            <script>
                                $('#forgetpwd').click(function () {
                                    $('.left_box').hide();
                                    $('.forgetpwd_bok').show();
                                    $('.tonext').show();
                                    $('.tab-one').text('回到登陆');
                                    $('.tab-one').removeClass('active');
                                });

                                //第一个下一步判断
                                $('.tonext').click(function () {
                                    var now_step = $(this).attr('name');
                                    if (now_step === 'one') {
                                        $.ajax({
                                            async: true,
                                            dataType: 'json',
                                            type: 'get',
                                            url: "{% url 'login:forgetpwd_1' %}",
                                            data: {
                                                csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val(),
                                                fuserid: $('#fuserid').val(),
                                            },
                                            success: function (data) {
                                                if (data.msg == 1) {
                                                    $('.forgetpwd_step1').hide();
                                                    $('.forgetpwd_step2').show();
                                                    $('.phonenumber').text(data.phonenumber);
                                                    $('#js_err_domss').text('');
                                                    $('.tonext').attr('name', 'two');
                                                    console.log(data.code)
                                                } else {
                                                    layer.msg('无效的用户ID');
                                                    $('#js_err_domss').text('无效的用户ID')
                                                }
                                            }
                                        })
                                    }
                                    else if(now_step === 'two'){
                                        $.ajax({
                                            async: true,
                                            dataType: 'json',
                                            type: 'post',
                                            url: "{% url 'login:forgetpwd_2' %}",
                                            data: {
                                                csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val(),
                                                fphonecode: $('#fphonecode').val(),
                                            },
                                            success: function (data) {
                                                if (data.msg == 1) {
                                                    $('.forgetpwd_step1').hide();
                                                    $('.forgetpwd_step2').hide();
                                                    $('.forgetpwd_step3').show();
                                                    $('#js_err_domss').text('');
                                                    $('.tonext').attr('name', 'three');
                                                } else {
                                                    layer.msg('短信验证码错误');
                                                    $('#js_err_domss').text('短信验证码有误！')
                                                }
                                            }
                                        })
                                    }
                                    else if(now_step === 'three'){
                                        $.ajax({
                                            async: true,
                                            dataType: 'json',
                                            type: 'post',
                                            url: "{% url 'login:forgetpwd_3' %}",
                                            data: {
                                                csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val(),
                                                fpwd: $('#fpwd').val(),
                                            },
                                            success: function (data) {
                                                if (data.msg == 1) {
                                                    $('.forgetpwd_step1').hide();
                                                    $('.forgetpwd_step2').hide();
                                                    $('.forgetpwd_step3').hide();
                                                    $('.forgetpwd_step4').show();
                                                    $('#js_err_domss').text('');
                                                    $('.tonext').attr('name', 'four');
                                                    $('.tonext').text('立即登录')
                                                } else {
                                                    layer.msg(data.msg);
                                                    $('#js_err_domss').text(data.msg)
                                                }
                                            }
                                        })
                                    }
                                    else if(now_step === 'four'){
                                        location.href='/login'
                                    }




                                })
                            </script>
                        <!--忘记密码盒子end-->

                    <script>

                        // 注册 tab切换
                        $('#tabTwo').click(function () {
                            $('.left_box').hide();
                            $('#tabOne').removeClass('active');
                            $(this).addClass('active');
                            $('.right_box').show();
                            $('.new_box').hide();
                            $('.forgetpwd_bok').hide();
                        });
                        //登陆tab 切换
                        $('#tabOne').click(function () {
                            $('.right_box').hide();
                            $('#tabTwo').removeClass('active');
                            $(this).addClass('active');
                            $('.left_box').show();
                            $('.new_box').hide();
                            $('.forgetpwd_bok').hide();
                        });

                         //页面加载时自动更新验证码
                            window.onload=function(){
                                $.ajax({
                                  async: true,
                                  dataType:'json',
                                  type:"get",
                                  url:"{% url 'login:checkma' %}",
                                  success:function (data) {
                                      $('.verify_img').attr("src",data.msg)
                                  }
                              })
                            };
                        //验证码绑定点击事件，点击更换
                          $(document).on('click','.verify_img',function(){
                              $.ajax({
                                  async: true,
                                  dataType:'json',
                                  type:"get",
                                  url:"{% url 'login:checkma' %}",
                                  success:function (data) {
                                      console.log(data.msg);
                                      $('.verify_img').attr("src",data.msg)
                                  }
                              })
                         });
                            //登陆点击
                         $('.sub').on('click', function(){
                             var index = layer.load(3);
                            $.ajax({
                                async:true,
                                dataType:'json',
                                type:'POST',
                                url:'{% url "login:index_show" %}',
                                data:{
                                  csrfmiddlewaretoken:$('[name=csrfmiddlewaretoken]').val(),
                                  userid:$('[name=userid]').val(),
                                  userpwd:$('#password').val(),
                                  imgCode:$('[name=imgCode]').eq(0).val(),
                                },
                                success:function (data) {
                                    if(data.msg==1){
                                        layer.close(index);
                                        layer.msg('您好！'+data.username+' , 欢迎来到3Q···');
                                       setTimeout(function () {
                                        location.href=data.href
                                         },1000);
                                    }else{
                                        layer.msg(data.msg);
                                        $('#js_err_dom').text(data.msg);
                                        $.ajax({
                                          async: true,
                                          dataType:'json',
                                          type:"get",
                                          url:"{% url 'login:checkma' %}",
                                          success:function (data) {
                                              $('.verify_img').attr("src",data.msg)
                                          }
                                      });
                                        layer.close(index);
                                    }
                                }
                            })
                         });

                        function isPhone(phone){
                                return /^1(3\d|4\d|5\d|6\d|7\d|8\d|9\d)\d{8}$/g.test(phone);
                        }


                        //发送验证码按钮点击
                         $('.get_yzm').click(function () {
                             if(isPhone($('[name=phone]').val())){
                              $.ajax({
                                async:true,
                                dataType:'json',
                                type:'POST',
                                url:'{% url "login:checkimgyzm" %}',
                                data:{
                                  csrfmiddlewaretoken:$('[name=csrfmiddlewaretoken]').val(),
                                  phone:$('[name=phone]').val(),
                                  imgCode:$('[name=imgCode]').eq(1).val(),
                                },
                                success:function (data) {
                                    if(data.msg==1){
                                        $('#js_err_doms').text('');
                                        $(showtime(30));
                                        layer.msg('验证码以发送，请注意查收···');
                                        console.log(data.code)
                                    }else{
                                        layer.msg(data.msg);
                                        $('#js_err_doms').text(data.msg);
                                        $.ajax({
                                          async: true,
                                          dataType:'json',
                                          type:"get",
                                          url:"{% url 'login:checkma' %}",
                                          success:function (data) {
                                              $('.verify_img').attr("src",data.msg)
                                          }
                                      });
                                    }
                                }
                            });
                            }else{
                                 $('#js_err_doms').text('请输入正确格式的手机号');
                             }
                         });

                        //注册按钮
                        $('.register').click(function () {
                             if(isPhone($('[name=phone]').val())){
                              $.ajax({
                                async:true,
                                dataType:'json',
                                type:'POST',
                                url:'{% url "login:register" %}',
                                data:{
                                  csrfmiddlewaretoken:$('[name=csrfmiddlewaretoken]').val(),
                                  phone:$('[name=phone]').val(),
                                  userpwd:$('#pwd').val(),
                                  phonecode:$('#yzm').val(),
                                  imgCode:$('[name=imgCode]').eq(1).val(),
                                },
                                success:function (data) {
                                    if(data.msg==1){
                                        $('#js_err_doms').text('');
                                        layer.msg('注册成功！');
                                        $('.right_box').hide();
                                        $('.new_box').show();
                                        $('.register_success').text(data.userinfo)
                                    }else{
                                        layer.msg(data.msg);
                                        $('#js_err_doms').text(data.msg);
                                        $.ajax({
                                          async: true,
                                          dataType:'json',
                                          type:"get",
                                          url:"{% url 'login:checkma' %}",
                                          success:function (data) {
                                              $('.verify_img').attr("src",data.msg)
                                          }
                                      });
                                    }
                                }
                            });
                            }else{
                                 $('#js_err_doms').text('请输入正确格式的手机号');
                             }
                         });




                         // 30秒
                        function showtime(t){
                            $('.get_yzm').addClass('disabled');
                            for(i=1;i<=t;i++) {
                                window.setTimeout("update_p(" + i + ","+t+")", i * 1000);
                            }

                        }

                        function update_p(num,t) {
                            if(num == t) {
                                $('.get_yzm').text('重新发送');
                                $('.get_yzm').removeClass('disabled');
                            }
                            else {
                                printnr = t-num;
                                $('.get_yzm').text( " (" + printnr +")秒后重新发送");
                            }
                        }

                            </script>

                    </div>
                </div>



                </div>
            </div>
        </div>
    </div>
</div>
<div style="margin-bottom: 0">
    <center>
        <span>©️2020 3Q   欢迎来到3Q博客，我们致力于打造出一个IT精英汇聚技术社区  本网站仅作为个人教学练习使用，无任何商业或是盈利目的 所有素材均来自<a href="https://www.csdn.net/">https://www.csdn.net/</a></span>
    </center>
</div>
    <script type="text/javascript" src="../static/js/manifest.285a9d92aa7602145d99.js"></script>
    <script type="text/javascript" src="../static/js/vendor.57246196bfc5c3227559.js"></script>
    <script type="text/javascript" src="../static/js/login.6702b4eeffd28ce67923.js"></script>


</body>
{% endblock %}
</html>